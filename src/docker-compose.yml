version: '3.8'

services:
  mts-deploy-ai:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mts-deploy-ai

    # Переменные окружения из .env файла
    env_file:
      - .env

    # Пробросить директорию для выходных файлов
    volumes:
      - ./output:/app/output
      - ./templates:/app/templates:ro

    # Порт для REST API (опционально)
    ports:
      - "8000:8000"

    # Restart policy
    restart: unless-stopped

    # Healthcheck
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

    # Логирование
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# Volumes для персистентности
volumes:
  output:
    driver: local

# Сеть
networks:
  default:
    name: mts-deploy-network
